<!DOCTYPE html>
<html lang="en">
<head>
  <base target="_top" />
  <meta charset="UTF-8" />
  <title>B2A Employee Control Centre</title>

  <!-- Vuetify 2 -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.15/dist/vuetify.min.css" rel="stylesheet">
  <!-- ApexCharts -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-apexcharts"></script>
  <!-- Vue 2 -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <!-- Vuetify JS -->
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.6.15/dist/vuetify.min.js"></script>

  <!-- Custom Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Roboto+Slab:wght@600&display=swap" rel="stylesheet">

  <style>
    html, body, #app {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', sans-serif;
      background-color: #f5f5f5 !important;
    }

    .v-application {
      background-color: #000000 !important;
    }

    h1, h2, h3, .headline, .subtitle-1 {
      font-family: 'Roboto Slab', serif !important;
      font-weight: 600;
      color: #2c3e50;
    }

    .v-app-bar, .v-navigation-drawer {
      color: #FFFFFF !important;
    }

    .v-data-table-header th {
      color: #FFFFFF !important;
      text-align: left;
      font-weight: 500;
      background-color: #424242 !important;
    }
  </style>
</head>
<body>
  <div id="app">
    <v-app dark>
      <!-- App Bar -->
      <v-app-bar app color="primary" dark>
        <v-toolbar-title>B2A Employee Control Centre</v-toolbar-title>
        <v-spacer></v-spacer>
        <v-btn small text @click="logout">Logout</v-btn>
      </v-app-bar>

      <!-- Navigation Drawer -->
      <v-navigation-drawer app temporary v-model="drawer">
        <v-list dense>
          <v-list-item>
            <v-list-item-content>
              <v-list-item-title class="title">{{ user.FirstName }} {{ user.LastName }}</v-list-item-title>
              <v-list-item-subtitle>{{ user.Role }}</v-list-item-subtitle>
            </v-list-item-content>
          </v-list-item>

          <v-divider></v-divider>

          <v-list-item v-for="item in menuItems" :key="item.text" @click="navigate(item)">
            <v-list-item-icon>
              <v-icon>{{ item.icon }}</v-icon>
            </v-list-item-icon>
            <v-list-item-title>{{ item.text }}</v-list-item-title>
          </v-list-item>
        </v-list>
      </v-navigation-drawer>

      <!-- Main Content -->
      <v-main>
        <v-container fluid>
          <!-- Dashboard View -->
          <v-card v-if="view === 'dashboard'" class="ma-4 pa-4" elevation="3">
            <v-card-title>Welcome, {{ user.FirstName }}</v-card-title>
            <v-card-text>
              <p><strong>Email:</strong> {{ user.Email }}</p>
              <p><strong>Department:</strong> {{ user.Department }}</p>
              <p><strong>Role:</strong> {{ user.Role }}</p>
            </v-card-text>
          </v-card>

          <!-- Placeholder for future views -->
          <v-card v-if="view === 'users'" class="ma-4 pa-4" elevation="3">
            <v-card-title>ðŸ›  User Management (Coming Soon)</v-card-title>
            <v-card-text>This is where user management will go.</v-card-text>
          </v-card>
        </v-container>
      </v-main>
    </v-app>
  </div>

  <script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: () => ({
        user: {},
        drawer: false,
        view: 'dashboard',
        menuItems: []
      }),
      methods: {
        setupMenu() {
          const role = this.user.Role;

          if (role === 'Administrator') {
            this.menuItems = [
              { text: 'Dashboard', icon: 'mdi-view-dashboard' },
              { text: 'Users', icon: 'mdi-account-multiple' },
              { text: 'Settings', icon: 'mdi-cog' }
            ];
          } else if (role === 'Manager') {
            this.menuItems = [
              { text: 'Dashboard', icon: 'mdi-view-dashboard' },
              { text: 'Team Shifts', icon: 'mdi-calendar-clock' },
              { text: 'Invoices', icon: 'mdi-file-document' }
            ];
          } else if (role === 'Employee') {
            this.menuItems = [
              { text: 'Dashboard', icon: 'mdi-home' },
              { text: 'My Shifts', icon: 'mdi-calendar-check' },
              { text: 'Invoices', icon: 'mdi-cash' }
            ];
          } else if (role === 'CFO') {
            this.menuItems = [
              { text: 'Dashboard', icon: 'mdi-finance' },
              { text: 'Reports', icon: 'mdi-chart-bar' },
              { text: 'Invoices', icon: 'mdi-currency-usd' }
            ];
          } else {
            this.menuItems = [{ text: 'Dashboard', icon: 'mdi-alert' }];
          }
        },
        navigate(item) {
          this.view = item.text.toLowerCase().replace(/\s+/g, '');
        },
        logout() {
          alert('Logout feature not yet implemented.');
        }
      },
      created() {
        const self = this;

        google.script.run
          .withSuccessHandler(function(res) {
            if (res && res.success) {
              self.user = res.data;
              self.setupMenu();
            } else {
              alert(res?.error || 'User not found or invalid response.');
            }
          })
          .withFailureHandler(function(err) {
            alert('Script error: ' + err.message);
          })
          .getUserSession(); // âœ… no arguments
      }
    });
  </script>
</body>
</html>